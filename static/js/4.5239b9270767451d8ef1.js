webpackJsonp([4],{"7Ogj":function(t,n,o){t.exports=o.p+"static/img/logo.da6427b.png"},K31e:function(t,n,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=o("fZjL"),e=o.n(s),i=o("woOf"),r=o.n(i),a=o("kxiW"),c=o.n(a),u=o("7Ogj"),l=o.n(u),g=o("uYd0"),f={data:function(){return{toggleSignForm:!0,userInfoBySign:{account:"",password:""},accountListByDB:[],logo:l.a,userInfoByDB:null,isAuth:!1}},methods:{login:function(t){var n=this,o=null;switch(t){case"google":o=new c.a.auth.GoogleAuthProvider}g.c.signInWithPopup(o).then(function(t){n.userInfoByDB=t.user;var o=t.user;return{displayName:o.displayName,email:o.email,emailVerified:o.emailVerified}}).then(function(t){n.$store.commit("setLoginType","app"),console.log("[user]",t),n.$store.commit("setUserInfo",t),n.$router.push("/")}).catch(function(t){return n.$swalErrorHandle(t)})},validate:function(){var t=this,n=this.userInfoBySign,o=n.account,s=n.password,e=this.userInfoBySign.account,i="";if(!o)throw Error("帳號必填");if(!o.match(this.$accountRegex))throw Error("帳號格式錯誤。須含英文及數字，開頭是英文");if(!s)throw Error("密碼必填");if(this.toggleSignForm){var r=this.accountListByDB.find(function(n){return n===t.userInfoBySign.account});g.b.ref(e+"/password").on("value",function(t){i=t.val()});var a=s===i;if(!r)throw Error("糟糕，查無此帳號");if(!a)throw Error("密碼錯誤")}else{var c=this.accountListByDB.find(function(t){return t===o});if(console.log("[duplicateUser]",c),c)throw Error("糟糕，此帳號已存在")}return!0},signIn:function(){try{this.validate(),console.log("[userInfoBySign]",this.userInfoBySign),this.$store.commit("setLoginType","default"),this.$store.commit("setUserInfo",this.userInfoBySign),this.$messageHandle("success","登入成功！"),this.$router.push("/")}catch(t){this.$swalErrorHandle(t.message)}},signUp:function(){var t=this;try{this.validate();var n=this.userInfoBySign.account;console.log("[userDBRef]",n),this.$store.commit("setLoginType","default"),g.b.ref(""+n).set({password:this.userInfoBySign.password}),g.b.ref(n+"/todoList").on("value",function(o){var s=o.val(),e=r()({},t.todo);e.name="default",e.isShow=!1,s?t.todoGroupList=s:g.b.ref(n+"/todoList/today").push(e),console.log("[userInfoBySign]",t.userInfoBySign),t.$store.commit("setUserInfo",t.userInfoBySign),t.$router.push("/")})}catch(t){this.$swalErrorHandle(t.message)}},toggleBlock:function(){this.toggleSignForm=!this.toggleSignForm,this.userInfoBySign.account="",this.userInfoBySign.password=""}},created:function(){var t=this;g.b.ref("/").on("value",function(n){var o=n.val();t.accountListByDB=e()(o),console.log("[accountListByDB]",t.accountListByDB)})},beforeCreate:function(){var t=this;g.c.onAuthStateChanged(function(n){n&&(t.userInfoByDB=n,t.isAuth=!0)})}},p={render:function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"login d-flex flex-column align-items-center"},[t._m(0),t._v(" "),o("img",{staticClass:"animated zoomIn mb-3",attrs:{src:t.logo,alt:""}}),t._v(" "),o("div",{staticClass:"animated fadeInUp w-100"},[o("form",[o("div",{staticClass:"form-group "},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.userInfoBySign.account,expression:"userInfoBySign.account"}],staticClass:"form-control",attrs:{type:"email","aria-describedby":"emailHelp",placeholder:"Account"},domProps:{value:t.userInfoBySign.account},on:{input:function(n){n.target.composing||t.$set(t.userInfoBySign,"account",n.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-group"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.userInfoBySign.password,expression:"userInfoBySign.password"}],staticClass:"form-control",attrs:{type:"password",placeholder:"Password"},domProps:{value:t.userInfoBySign.password},on:{input:function(n){n.target.composing||t.$set(t.userInfoBySign,"password",n.target.value)}}})]),t._v(" "),t.toggleSignForm?o("button",{staticClass:"btn btn-primary mb-3",attrs:{type:"submit"},on:{click:function(n){return n.preventDefault(),t.signIn(n)}}},[t._v("Sign In")]):o("button",{staticClass:"btn btn-success mb-3",attrs:{type:"submit"},on:{click:function(n){return n.preventDefault(),t.signUp(n)}}},[t._v("Sign Up")]),t._v(" "),o("br"),t._v(" "),t.toggleSignForm?o("div",{staticClass:"sign-up-wrap"},[t._v("Create Account,\n        "),o("span",{staticClass:"text-success sign-up",on:{click:t.toggleBlock}},[t._v("Sign Up")])]):o("div",{staticClass:"sign-up-wrap"},[o("span",{staticClass:"text-primary sign-up",on:{click:t.toggleBlock}},[t._v("Back Sign In")])])]),t._v(" "),o("hr"),t._v(" "),o("button",{staticClass:"btn btn-outline-primary w-100",on:{click:function(n){return t.login("google")}}},[o("font-awesome-icon",{staticClass:"ml-auto text-primary",attrs:{"fixed-width":"",size:"lg",icon:["fab","google"]}}),t._v("\n      Use Google Account Sign In\n    ")],1)])])},staticRenderFns:[function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{staticClass:"animated fadeInDown"},[this._v("Your "),n("span",{staticClass:"text-primary"},[this._v("ToDoList")])])}]};var d=o("VU/8")(f,p,!1,function(t){o("lklc")},null,null);n.default=d.exports},lklc:function(t,n){}});
//# sourceMappingURL=4.5239b9270767451d8ef1.js.map